<!-- Voice Recognition Component -->
<div class="voice-section">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-12">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">
              <span class="material-icons mr-2">mic</span>
              Voice Assistant
            </h3>
            <div class="status-indicator-container">
              <span id="status-indicator" class="status-indicator status-offline"></span>
              <span id="status-text">Checking...</span>
            </div>
          </div>
          <div class="card-body">
            
            <!-- Voice Command Upload Section -->
            <div class="voice-section-item mb-4">
              <h5 class="section-title">
                <span class="material-icons mr-2">upload_file</span>
                Voice Command Upload
              </h5>
              <p class="text-muted">Upload an audio file to convert speech to text and get an AI response</p>
              
              <div class="form-group">
                <label for="audioFile" class="form-label">Audio File</label>
                <input type="file" class="form-control-file" id="audioFile" accept=".wav,.mp3,.ogg,.m4a,.flac,.webm">
                <small class="form-text text-muted">Supported formats: WAV, MP3, OGG, M4A, FLAC, WEBM (Max 16MB)</small>
              </div>
              
              <button type="button" class="btn btn-primary" onclick="uploadVoiceCommand()" id="voiceBtn">
                <span class="material-icons mr-1">send</span>
                Process Voice Command
              </button>
              
              <div id="voiceLoading" class="loading-overlay" style="display: none;">
                <div class="loading-content">
                  <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Loading...</span>
                  </div>
                  <p class="mt-2">ðŸŽ§ Processing voice command...</p>
                </div>
              </div>
              
              <div id="voiceResult" class="result-container mt-3"></div>
            </div>

            <!-- Text Command Section -->
            <div class="voice-section-item mb-4">
              <h5 class="section-title">
                <span class="material-icons mr-2">keyboard</span>
                Text Command
              </h5>
              <p class="text-muted">Enter text to get an AI response with voice output</p>
              
              <div class="form-group">
                <label for="textInput" class="form-label">Text Command</label>
                <textarea class="form-control" id="textInput" rows="3" placeholder="Enter your text command here..."></textarea>
              </div>
              
              <button type="button" class="btn btn-primary" onclick="sendTextCommand()" id="textBtn">
                <span class="material-icons mr-1">send</span>
                Send Text Command
              </button>
              
              <div id="textLoading" class="loading-overlay" style="display: none;">
                <div class="loading-content">
                  <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Loading...</span>
                  </div>
                  <p class="mt-2">ðŸ’­ Processing text command...</p>
                </div>
              </div>
              
              <div id="textResult" class="result-container mt-3"></div>
            </div>

            <!-- Demo Commands Section -->
            <div class="voice-section-item">
              <h5 class="section-title">
                <span class="material-icons mr-2">smart_toy</span>
                Demo Commands
              </h5>
              <p class="text-muted">Try these example commands to test the voice assistant</p>
              
              <div class="demo-buttons">
                <button type="button" class="btn btn-outline-secondary btn-sm mr-2 mb-2" onclick="sendDemoCommand('What is the weather like today?')">
                  Weather Question
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm mr-2 mb-2" onclick="sendDemoCommand('Navigate to the nearest coffee shop')">
                  Navigation
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm mr-2 mb-2" onclick="sendDemoCommand('Tell me a joke')">
                  Entertainment
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm mr-2 mb-2" onclick="sendDemoCommand('What time is it?')">
                  Time Query
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm mr-2 mb-2" onclick="sendDemoCommand('Check my account balance')">
                  Banking Query
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm mr-2 mb-2" onclick="sendDemoCommand('Help me with a transaction')">
                  Transaction Help
                </button>
              </div>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.voice-section {
  margin: 20px 0;
}

.voice-section-item {
  padding: 20px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  background-color: #fafafa;
}

.section-title {
  color: #1976d2;
  font-weight: 600;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
}

.status-indicator-container {
  display: flex;
  align-items: center;
  margin-left: auto;
}

.status-indicator {
  display: inline-block;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin-right: 8px;
}

.status-online {
  background-color: #4caf50;
}

.status-offline {
  background-color: #f44336;
}

.loading-overlay {
  position: relative;
  background-color: rgba(255, 255, 255, 0.9);
  border-radius: 8px;
  padding: 20px;
  text-align: center;
}

.loading-content {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.result-container {
  padding: 15px;
  border-radius: 8px;
  background-color: #f8f9fa;
  border-left: 4px solid #007bff;
}

.result-container.error {
  background-color: #f8d7da;
  border-left-color: #dc3545;
  color: #721c24;
}

.result-container.success {
  background-color: #d4edda;
  border-left-color: #28a745;
  color: #155724;
}

.audio-player {
  margin-top: 10px;
}

.audio-player audio {
  width: 100%;
  max-width: 400px;
}

.demo-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.btn {
  transition: all 0.3s ease;
}

.btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

@media (max-width: 768px) {
  .voice-section-item {
    padding: 15px;
  }
  
  .demo-buttons {
    flex-direction: column;
  }
  
  .demo-buttons .btn {
    margin-bottom: 8px;
  }
}
</style>

<script>
// Voice API Configuration
const VOICE_API_BASE = 'http://localhost:5500'; // Adjust this to match your voice service URL

// Check API status on component load
document.addEventListener('DOMContentLoaded', function() {
  if (document.querySelector('#status-indicator')) {
    checkVoiceStatus();
  }
});

async function checkVoiceStatus() {
  try {
    const response = await fetch(`${VOICE_API_BASE}/health`);
    const data = await response.json();
    
    const statusIndicator = document.getElementById('status-indicator');
    const statusText = document.getElementById('status-text');
    
    if (response.ok) {
      statusIndicator.className = 'status-indicator status-online';
      statusText.textContent = 'Voice service is online';
    } else {
      throw new Error('API returned error');
    }
  } catch (error) {
    const statusIndicator = document.getElementById('status-indicator');
    const statusText = document.getElementById('status-text');
    
    statusIndicator.className = 'status-indicator status-offline';
    statusText.textContent = 'Voice service is offline';
  }
}

async function uploadVoiceCommand() {
  const fileInput = document.getElementById('audioFile');
  const file = fileInput.files[0];
  
  if (!file) {
    showAlert('Please select an audio file', 'warning');
    return;
  }

  const loadingDiv = document.getElementById('voiceLoading');
  const resultDiv = document.getElementById('voiceResult');
  const button = document.getElementById('voiceBtn');
  
  // Show loading
  showLoading(loadingDiv, true);
  clearResult(resultDiv);
  setButtonState(button, true);

  try {
    const formData = new FormData();
    formData.append('audio', file);

    const response = await fetch(`${VOICE_API_BASE}/voice-command`, {
      method: 'POST',
      body: formData
    });

    const data = await response.json();
    
    if (response.ok) {
      displayResult(resultDiv, data, false);
    } else {
      displayResult(resultDiv, { error: data.error || 'Unknown error' }, true);
    }
  } catch (error) {
    displayResult(resultDiv, { error: 'Network error: ' + error.message }, true);
  } finally {
    showLoading(loadingDiv, false);
    setButtonState(button, false);
  }
}

async function sendTextCommand() {
  const textInput = document.getElementById('textInput');
  const text = textInput.value.trim();
  
  if (!text) {
    showAlert('Please enter some text', 'warning');
    return;
  }

  await processTextCommand(text, 'textResult', 'textLoading', 'textBtn');
}

async function sendDemoCommand(text) {
  await processTextCommand(text, 'textResult', 'textLoading', 'textBtn');
}

async function processTextCommand(text, resultId, loadingId, buttonId) {
  const loadingDiv = document.getElementById(loadingId);
  const resultDiv = document.getElementById(resultId);
  const button = document.getElementById(buttonId);
  
  // Show loading
  showLoading(loadingDiv, true);
  clearResult(resultDiv);
  setButtonState(button, true);

  try {
    const response = await fetch(`${VOICE_API_BASE}/text-command`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ text: text })
    });

    const data = await response.json();
    
    if (response.ok) {
      displayResult(resultDiv, data, false);
    } else {
      displayResult(resultDiv, { error: data.error || 'Unknown error' }, true);
    }
  } catch (error) {
    displayResult(resultDiv, { error: 'Network error: ' + error.message }, true);
  } finally {
    showLoading(loadingDiv, false);
    setButtonState(button, false);
  }
}

function displayResult(container, data, isError) {
  container.className = 'result-container' + (isError ? ' error' : ' success');
  
  if (isError) {
    container.innerHTML = `
      <div class="d-flex align-items-center">
        <span class="material-icons text-danger mr-2">error</span>
        <strong>Error:</strong> ${data.error}
      </div>
    `;
    return;
  }

  let html = '<div class="result-content">';
  
  if (data.recognized_text) {
    html += `
      <div class="result-item mb-3">
        <h6 class="text-primary">
          <span class="material-icons mr-1">record_voice_over</span>
          Recognized Text:
        </h6>
        <p class="mb-0">${data.recognized_text}</p>
      </div>
    `;
  }
  
  if (data.input_text) {
    html += `
      <div class="result-item mb-3">
        <h6 class="text-primary">
          <span class="material-icons mr-1">keyboard</span>
          Input Text:
        </h6>
        <p class="mb-0">${data.input_text}</p>
      </div>
    `;
  }
  
  if (data.response_text) {
    html += `
      <div class="result-item mb-3">
        <h6 class="text-success">
          <span class="material-icons mr-1">smart_toy</span>
          AI Response:
        </h6>
        <p class="mb-0">${data.response_text}</p>
      </div>
    `;
  }
  
  if (data.audio_response_url) {
    html += `
      <div class="result-item">
        <h6 class="text-info">
          <span class="material-icons mr-1">volume_up</span>
          Audio Response:
        </h6>
        <div class="audio-player">
          <audio controls class="w-100">
            <source src="${VOICE_API_BASE}${data.audio_response_url}" type="audio/mpeg">
            Your browser does not support the audio element.
          </audio>
        </div>
      </div>
    `;
  }
  
  html += '</div>';
  container.innerHTML = html;
}

function showLoading(element, show) {
  if (element) {
    element.style.display = show ? 'block' : 'none';
  }
}

function clearResult(element) {
  if (element) {
    element.innerHTML = '';
  }
}

function setButtonState(button, disabled) {
  if (button) {
    button.disabled = disabled;
  }
}

function showAlert(message, type = 'info') {
  // You can integrate this with your existing alert system
  alert(message);
}
</script>